var Evolv=function(t){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,e)};var e=function(t){function e(i,e,n){void 0===n&&(n=5e3);var o=t.call(this,n)||this;return o.acc=i,o.aid=e,o.maxWaitTime=n,o}return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.sendMetrics=function(t,i){var e=this.getUid(i),n=this.getCidEid(i);this.sendRATEvent(e,n)},e.prototype.sendRATEvent=function(t,i){var e=i.split(":",2),n=e[0],o=e[1],r={acc:this.acc,aid:this.aid,etype:"async",cp:{userid:t,experimentid:o,candidateid:n}};try{fetch("https://rat.rakuten.co.jp",{method:"POST",body:"cpkg_none="+JSON.stringify(r),headers:{}})}catch(t){console.error("Error:",t)}},e}(function(){function t(t){void 0===t&&(t=5e3),this.maxWaitTime=t,this.queue=[],this.interval=50,this.activeCandidateEvents={confirmed:{},contaminated:{}},this.contaminations={},this.waitForEvolv(this.configureListeners.bind(this))}return t.prototype.configureListeners=function(){var t=this;window.evolv.client.on("confirmed",(function(i){t.sendMetricsForActiveCandidates(i)}))},t.prototype.sendMetricsForActiveCandidates=function(t){for(var i,e=this.getContextKey(t),n=this.getEvolv().context.get(e)||[],o=0;o<n.length;o++)if(this.activeCandidateEvents[t]&&!this.activeCandidateEvents[t][null===(i=null==n?void 0:n[o])||void 0===i?void 0:i.cid]){var r=this.lookupFromAllocations(n[o].cid);this.sendMetrics(t,r),this.activeCandidateEvents[t][n[o].cid]=!0}},t.prototype.lookupFromAllocations=function(t){for(var i=this.getEvolv().context.get("experiments").allocations,e=0;e<i.length;e++){var n=i[e];if(n.cid===t)return n}},t.prototype.getContextKey=function(t){switch(t){case"confirmed":return"confirmations";case"contaminated":return"contaminations";default:return""}},t.prototype.getEvolv=function(){return window.evolv},t.prototype.waitForEvolv=function(t){var i=this;if(this.getEvolv())t&&t();else var e=Date.now(),n=setInterval((function(){if(Date.now()-e>i.maxWaitTime)return clearInterval(n),void console.log("Evolv: Analytics integration timed out - couldn't find Evolv");i.getEvolv()&&(t&&t(),clearInterval(n))}),this.interval)},t.prototype.getCidEid=function(t){return t.cid?t.cid:""},t.prototype.getUid=function(t){return t.uid?t.uid:""},t}());return t.RATClient=e,t}({});

const client = new Evolv.RATClient(9999, 2);
